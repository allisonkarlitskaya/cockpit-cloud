---
apiVersion: v1
kind: Template
labels:
  app: cockpit-cloud
  template: cockpit-cloud
metadata:
  annotations:
    description: Backend service for cockpit-cloud in console.redhat.com
  name: cockpit-cloud
objects:

- kind: Pod
  apiVersion: v1
  metadata:
    name: cockpit-cloud-pod
    labels:
      infra: cockpit-cloud
  spec:
    containers:
      - name: cockpit-cloud
        image: quay.io/cloudservices/cockpit-cloud
        ports:
          - name: session
            containerPort: 8080
          - name: cockpit
            containerPort: 9090
        volumeMounts:
          - name: secrets
            mountPath: /container/secrets
            readOnly: true
    volumes:
      - name: secrets
        secret:
          secretName: cockpit-cloud-pod-keys
    restartPolicy: Never

- kind: Service
  apiVersion: v1
  metadata:
    name: cockpit-cloud-service
  spec:
    ports:
    - name: session
      targetPort: 8080
      port: 8080
      protocol: TCP
    - name: cockpit
      targetPort: 9090
      port: 9090
      protocol: TCP
    selector:
      infra: cockpit-cloud

- kind: Route
  apiVersion: route.openshift.io/v1
  metadata:
    name: cockpit-cloud-session
  spec:
    to:
      kind: Service
      name: cockpit-cloud-service
    port:
      targetPort: 8080
    tls:
      termination: passthrough

- kind: Route
  apiVersion: route.openshift.io/v1
  metadata:
    name: cockpit-cloud-pod
  spec:
    to:
      kind: Service
      name: cockpit-cloud-service
    port:
      targetPort: 9090
    tls:
      termination: edge
